var cone_maps=function(e,t){"use strict";let a={tile_layer:function(e,t){e.layer_created(new L.TileLayer(t.urlTemplate,t.options),t)},geo_json:function(e,a){t.getJSON(a.dataUrl,(function(t){e.layer_created(new L.GeoJSON(t,a.options),a)}))}};class s{static initialize(e){t("div.cone-map",e).each((function(){let e=t(this),a=e.data("map-settings"),s=a.factory;new(ts.object_by_path(s))(e,a)}))}constructor(e,t){this.elem=e,this.id=e.attr("id"),this.layers=t.layers,this.default_center=t.center,this.default_zoom=t.zoom,this.default_bounds=t.bounds,this.map_options=t.options,this.control_options=t.control_options,this.markers=t.markers,this.markers_source=t.markers_source,this.marker_groups=t.groups,this.marker_groups_source=t.groups_source,this.create(),e.data("map-instance",this)}create(){this.create_map(),this.create_controls(),this.create_layers(),this.create_markers()}create_map(){this.map=new L.Map(this.id,this.map_options),this.default_bounds.length?this.map.fitBounds(this.default_bounds):this.map.setView(this.default_center,this.default_zoom)}create_controls(){this.map_layers=new L.Control.Layers([],[],this.control_options),this.map_layers.addTo(this.map)}create_layers(){for(let e of this.layers)a[e.factory](this,e)}layer_created(e,t){t.layer=e,(void 0===t.display||t.display)&&this.add_layer(e),"base"===t.category?this.map_layers.addBaseLayer(e,t.title):"overlay"===t.category&&this.map_layers.addOverlay(e,t.title)}add_layer(e){this.map.addLayer(e)}remove_layer(e){this.map.removeLayer(e)}create_markers(){for(let e of this.markers)this.create_marker(e);this.markers_source&&t.getJSON(this.markers_source,function(e){for(let t of e)this.create_marker(t)}.bind(this)),(this.markers||this.markers_source)&&this.map.on("popupopen",(function(e){let a=e.popup;ts.ajax.bind(t(a._contentNode))}))}create_marker(e){let t=new L.Marker(e.latlng,e.options).addTo(this.map);e.popup&&t.bindPopup(e.popup.content,e.popup.options)}}return t((function(){void 0!==window.ts?ts.ajax.register(s.initialize,!0):bdajax.register(s.initialize,!0)})),e.Map=s,e.layer_factories=a,Object.defineProperty(e,"__esModule",{value:!0}),e}({},jQuery);
