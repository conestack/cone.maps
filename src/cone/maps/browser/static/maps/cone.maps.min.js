var cone_maps=function(t,e){"use strict";function a(t){let e=window;for(let a of t.split("."))if(e=e[a],void 0===e)throw"Cannot locate map factory: "+t;return e}let r={tile_layer:function(t,e){t.layer_created(new L.TileLayer(e.urlTemplate,e.options),e)},geo_json:function(t,a){e.getJSON(a.dataUrl,(function(e){t.layer_created(new L.GeoJSON(e,a.options),a)}))}};class s{static initialize(t){e("div.cone-map",t).each((function(){let t=e(this);new(a(t.data("map-factory")))(t)}))}constructor(t){this.elem=t,this.id=t.attr("id"),this.layers=t.data("map-layers"),this.default_center=t.data("map-center"),this.default_zoom=t.data("map-zoom"),this.map_options=t.data("map-options"),this.control_options=t.data("map-control-options"),this.markers=t.data("map-markers"),this.markers_source=t.data("map-markers-source"),this.marker_groups=t.data("map-groups"),this.marker_groups_source=t.data("map-groups-source"),this.create(),t.data("map-instance",this)}create(){this.create_map(),this.create_controls(),this.create_layers(),this.create_markers()}create_map(){this.map=new L.Map(this.id,this.map_options),this.map.setView(this.default_center,this.default_zoom)}create_controls(){this.map_layers=new L.Control.Layers([],[],this.control_options),this.map_layers.addTo(this.map)}create_layers(){for(let t of this.layers)r[t.factory](this,t)}layer_created(t,e){e.layer=t,(void 0===e.display||e.display)&&this.add_layer(t),"base"===e.category?this.map_layers.addBaseLayer(t,e.title):"overlay"===e.category&&this.map_layers.addOverlay(t,e.title)}add_layer(t){this.map.addLayer(t)}remove_layer(t){this.map.removeLayer(t)}create_markers(){for(let t of this.markers)this.create_marker(t);this.markers_source&&e.getJSON(this.markers_source,function(t){for(let e of t)this.create_marker(e)}.bind(this)),(this.markers||this.markers_source)&&this.map.on("popupopen",(function(t){let a=t.popup;ts.ajax.bind(e(a._contentNode))}))}create_marker(t){let e=new L.Marker(t.latlng,t.options).addTo(this.map);t.popup&&e.bindPopup(t.popup.content,t.popup.options)}}return e((function(){void 0!==window.ts?ts.ajax.register(s.initialize,!0):bdajax.register(s.initialize,!0)})),t.Map=s,t.layer_factories=r,t.lookup_factory=a,Object.defineProperty(t,"__esModule",{value:!0}),t}({},jQuery);
